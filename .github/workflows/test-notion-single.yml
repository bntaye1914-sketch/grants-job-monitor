name: Test Single Job Push

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: pip install requests
      
      - name: Test single job
        env:
          NOTION_TOKEN: ${{ secrets.NOTION_TOKEN }}
          NOTION_DB_ID: ${{ secrets.NOTION_DB_ID }}
        run: |
          python -c "
          import os, json, requests
          from datetime import datetime
          
          NOTION_TOKEN = os.getenv('NOTION_TOKEN')
          NOTION_DB_ID = os.getenv('NOTION_DB_ID')
          
          # This payload attempts to match your database schema
          payload = {
              'parent': {'database_id': NOTION_DB_ID},
              'properties': {
                  'Opportunity': {'title': [{'text': {'content': 'TEST - DELETE ME'}}]},
                  'Source': {'select': {'name': 'USAJobs'}},
                  'Priority': {'select': {'name': 'High'}},
                  'Status': {'status': {'name': 'Monitoring'}},
                  'Type': {'select': {'name': 'Federal General'}},
                  'Date Added': {'date': {'start': datetime.now().strftime('%Y-%m-%d')}},
                  ''URL': {'url': 'https://test.com'},
                  'Job Hash': {'rich_text': [{'text': {'content': 'testhash123'}}]},
                  'Notes': {'rich_text': [{'text': {'content': 'Test'}}]}
              }
          }
          
          print('ðŸ§ª Testing payload:')
          print(json.dumps(payload, indent=2))
          print()
          
          try:
              response = requests.post(
                  'https://api.notion.com/v1/pages',
                  headers={
                      'Authorization': f'Bearer {NOTION_TOKEN}',
                      'Content-Type': 'application/json',
                      'Notion-Version': '2022-06-28'
                  },
                  json=payload
              )
              
              print(f'Status: {response.status_code}')
              print(f'Response body:')
              # This will show us the EXACT error from Notion
              print(json.dumps(response.json(), indent=2))
          except Exception as e:
              print(f'Script Error: {e}')
          "
